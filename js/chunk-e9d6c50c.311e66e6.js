(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e9d6c50c"],{"055f":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"post-create"}},[n("form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleCreatePost(e)}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"mb-2",attrs:{name:"title",type:"text",placeholder:"Title",id:"title"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),t.image?n("img",{attrs:{src:t.image,alt:"image",width:"640",height:"480"}}):t._e(),n("h6",{staticClass:"d-none"},[t._v("prevent medium editor from deleting input dom")]),n("medium-editor",{attrs:{name:"content",id:"content",text:t.content,options:t.options,"custom-tag":"h4"},on:{edit:t.applyTextEdit}}),n("div",{staticClass:"d-flex justify-content-between"},[n("button",{staticClass:"btn btn-success",attrs:{disabled:t.isPosting,type:"submit"}},[t._v(" "+t._s(t.isPosting?"Publising...":"Publish")+" ")]),n("label",{staticClass:"btn btn-primary",attrs:{for:"image"}},[t._v("Upload cover")]),n("input",{staticClass:"form-control-file d-none",attrs:{id:"image",type:"file",name:"image",accept:"image/*"},on:{change:t.handleFileChange}})])],1)])},r=[],a=(n("a4d3"),n("4de4"),n("e439"),n("dbb4"),n("b64b"),n("d3b7"),n("3ca3"),n("1276"),n("159b"),n("ddb0"),n("2b3d"),n("ade3")),s=(n("96cf"),n("684b")),o=n("4884"),c=n.n(o),u=n("2f62"),l=n("2fa3");function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(a["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={name:"PostCreate",components:{"medium-editor":c.a},data:function(){return{title:"",content:"",image:"",imageSrc:"",isPosting:!1,options:{toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h1","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",relativeContainer:null,standardizeSelectionStart:!1,static:!1,align:"center",sticky:!1,updateOnEmptySelection:!1},placeholder:{text:"Tell your story",hideOnClick:!0}}}},mounted:function(){this.imageDropListener()},methods:{handleFileChange:function(t){var e=t.target.files;if(e.length){var n=window.URL.createObjectURL(e[0]);this.image=n}},applyOptions:function(t){try{this.options=JSON.parse(t.target.value),this.optionsValid=!0}catch(e){this.optionsValid=!1}},applyTextEdit:function(t){t.event.target&&(this.content=t.event.target.innerHTML)},handleCreatePost:function(t){var e,n,i;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,this.isPosting=!0,e=new FormData(t.target),e.append("content",this.content),e.append("UserId",this.currentUser.id),r.next=7,regeneratorRuntime.awrap(s["a"].createPost(e));case 7:n=r.sent,i=n.data,"success"===i.status&&(l["a"].fire({icon:"success",title:"文章發布成功！"}),this.isPosting=!1,this.$router.push("/posts/".concat(i.PostId))),r.next=16;break;case 12:r.prev=12,r.t0=r["catch"](0),this.isPosting=!1,l["a"].fire({icon:"error",title:"發生錯誤，請稍後再試！"});case 16:case"end":return r.stop()}}),null,this,[[0,12]])},imageDropListener:function(){var t=this,e=document.querySelector("#content");e.addEventListener("drop",(function(){setTimeout((function(){var n,i,r;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:if(n=document.querySelector("#post-create img[src^='data:image']"),n){a.next=3;break}return a.abrupt("return",l["a"].fire({icon:"error",title:"上傳圖片失敗"}));case 3:return i=n.src.split(",")[1],a.next=6,regeneratorRuntime.awrap(s["a"].postImage({imageBase64:i}));case 6:r=a.sent,"success"===r.data.status&&(n.src=r.data.imgurLink,console.log(r.data.imgurLink),l["a"].fire({icon:"success",title:"圖片上傳成功!!"}),t.content=e.innerHTML);case 8:case"end":return a.stop()}}))}),100)}))}},computed:p({},Object(u["b"])(["currentUser"]))},f=m,g=(n("71f1"),n("2877")),b=Object(g["a"])(f,i,r,!1,null,"21a85d40",null);e["default"]=b.exports},"71f1":function(t,e,n){"use strict";var i=n("ebe4"),r=n.n(i);r.a},ebe4:function(t,e,n){}}]);
//# sourceMappingURL=chunk-e9d6c50c.311e66e6.js.map