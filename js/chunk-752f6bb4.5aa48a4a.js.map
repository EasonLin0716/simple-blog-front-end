{"version":3,"sources":["webpack:///./src/views/PostEdit.vue?b269","webpack:///src/views/PostEdit.vue","webpack:///./src/views/PostEdit.vue?c7e8","webpack:///./src/views/PostEdit.vue","webpack:///./src/views/PostEdit.vue?0370"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","on","$event","stopPropagation","preventDefault","handleEditPost","directives","name","rawName","value","expression","staticClass","domProps","target","composing","title","image","_e","_v","content","options","applyTextEdit","isPosting","_s","handleFileChange","staticRenderFns","data","authorId","toolbar","allowMultiParagraphSelection","buttons","diffLeft","diffTop","firstButtonClass","lastButtonClass","relativeContainer","standardizeSelectionStart","static","align","sticky","updateOnEmptySelection","components","methods","files","length","imageURL","applyOptions","JSON","parse","ev","optionsValid","event","innerHTML","imageDropListener","ed","addEventListener","setTimeout","computed","created","fetchPost","postId","mounted","beforeRouteUpdate","next","component"],"mappings":"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","file":"js/chunk-752f6bb4.5aa48a4a.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"post-create\"}},[_c('form',{on:{\"submit\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.handleEditPost($event)}}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.title),expression:\"title\"}],staticClass:\"form-control\",attrs:{\"name\":\"title\",\"type\":\"text\",\"placeholder\":\"Title\",\"id\":\"title\"},domProps:{\"value\":(_vm.title)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.title=$event.target.value}}}),(_vm.image)?_c('img',{attrs:{\"src\":_vm.image,\"alt\":\"image\",\"width\":\"640\",\"height\":\"480\"}}):_vm._e(),_c('h6',{staticClass:\"d-none\"},[_vm._v(\"prevent medium editor from deleting input dom\")]),_c('medium-editor',{attrs:{\"name\":\"content\",\"id\":\"content\",\"text\":_vm.content,\"options\":_vm.options,\"custom-tag\":\"h4\"},on:{\"edit\":_vm.applyTextEdit}}),_c('div',{staticClass:\"d-flex justify-content-between\"},[_c('button',{staticClass:\"btn btn-success\",attrs:{\"disabled\":_vm.isPosting,\"type\":\"submit\"}},[_vm._v(\" \"+_vm._s(!_vm.isPosting ? 'Edit' : 'Editing...')+\" \")]),_c('label',{staticClass:\"btn btn-primary\",attrs:{\"for\":\"image\"}},[_vm._v(\"Upload cover\")]),_c('input',{staticClass:\"form-control-file d-none\",attrs:{\"id\":\"image\",\"type\":\"file\",\"name\":\"image\",\"accept\":\"image/*\"},on:{\"change\":_vm.handleFileChange}})])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div id=\"post-create\">\r\n    <form @submit.stop.prevent=\"handleEditPost\">\r\n      <input\r\n        name=\"title\"\r\n        type=\"text\"\r\n        v-model=\"title\"\r\n        class=\"form-control\"\r\n        placeholder=\"Title\"\r\n        id=\"title\"\r\n      />\r\n      <img v-if=\"image\" :src=\"image\" alt=\"image\" width=\"640\" height=\"480\" />\r\n      <h6 class=\"d-none\">prevent medium editor from deleting input dom</h6>\r\n      <medium-editor\r\n        name=\"content\"\r\n        id=\"content\"\r\n        :text=\"content\"\r\n        :options=\"options\"\r\n        custom-tag=\"h4\"\r\n        v-on:edit=\"applyTextEdit\"\r\n      />\r\n      <div class=\"d-flex justify-content-between\">\r\n        <button :disabled=\"isPosting\" type=\"submit\" class=\"btn btn-success\">\r\n          {{ !isPosting ? 'Edit' : 'Editing...' }}\r\n        </button>\r\n        <label for=\"image\" class=\"btn btn-primary\">Upload cover</label>\r\n        <input\r\n          id=\"image\"\r\n          type=\"file\"\r\n          name=\"image\"\r\n          accept=\"image/*\"\r\n          class=\"form-control-file d-none\"\r\n          @change=\"handleFileChange\"\r\n        />\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport postsAPI from '../apis/posts'\r\nimport editor from 'vue2-medium-editor'\r\nimport { mapState } from 'vuex'\r\nimport { Toast } from './../utils/helpers'\r\nexport default {\r\n  name: 'PostEdit',\r\n  data() {\r\n    return {\r\n      title: '',\r\n      content: '',\r\n      image: '',\r\n      isPosting: false,\r\n      authorId: 0,\r\n      options: {\r\n        toolbar: {\r\n          allowMultiParagraphSelection: true,\r\n          buttons: [\r\n            'bold',\r\n            'italic',\r\n            'underline',\r\n            'anchor',\r\n            'h2',\r\n            'h3',\r\n            'quote'\r\n          ],\r\n          diffLeft: 0,\r\n          diffTop: -10,\r\n          firstButtonClass: 'medium-editor-button-first',\r\n          lastButtonClass: 'medium-editor-button-last',\r\n          relativeContainer: null,\r\n          standardizeSelectionStart: false,\r\n          static: false,\r\n          align: 'center',\r\n          sticky: false,\r\n          updateOnEmptySelection: false\r\n        }\r\n      }\r\n    }\r\n  },\r\n  components: {\r\n    'medium-editor': editor\r\n  },\r\n  methods: {\r\n    handleFileChange(e) {\r\n      const files = e.target.files\r\n      if (!files.length) return\r\n      const imageURL = window.URL.createObjectURL(files[0])\r\n      this.image = imageURL\r\n    },\r\n    applyOptions(ev) {\r\n      try {\r\n        this.options = JSON.parse(ev.target.value)\r\n        this.optionsValid = true\r\n      } catch (e) {\r\n        this.optionsValid = false\r\n      }\r\n    },\r\n    applyTextEdit(ev) {\r\n      if (ev.event.target) {\r\n        this.content = ev.event.target.innerHTML\r\n      }\r\n    },\r\n    async fetchPost(postId) {\r\n      const { data } = await postsAPI.getPost(postId)\r\n      this.title = data.post.title\r\n      this.content = data.post.content\r\n      this.authorId = data.author.id\r\n      this.image = data.post.cover\r\n      if (this.authorId !== this.currentUser.id) {\r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '很抱歉，您沒有編輯權限'\r\n        })\r\n        this.$router.push(`/posts/${postId}`)\r\n      }\r\n    },\r\n    async handleEditPost(e) {\r\n      try {\r\n        this.isPosting = true\r\n        const { id: postId } = this.$route.params\r\n        const formData = new FormData(e.target)\r\n        formData.append('content', this.content)\r\n        formData.append('userId', this.authorId)\r\n\r\n        const { data } = await postsAPI.putPost(formData, postId)\r\n        if (data.status === 'success') {\r\n          this.isPosting = false\r\n          Toast.fire({\r\n            icon: 'success',\r\n            title: '修改文章大成功！'\r\n          })\r\n          this.$router.push(`/posts/${postId}`)\r\n        }\r\n        if (data.status === 'error') {\r\n          this.isPosting = false\r\n          Toast.fire({\r\n            icon: 'error',\r\n            title: '發生錯誤，請稍後再試！'\r\n          })\r\n          this.$router.push(`/posts/${postId}`)\r\n        }\r\n      } catch (error) {\r\n        this.isPosting = false\r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '修改文章失敗，請稍後再試！'\r\n        })\r\n      }\r\n    },\r\n    imageDropListener() {\r\n      const ed = document.querySelector('#content')\r\n\r\n      ed.addEventListener('drop', () => {\r\n        setTimeout(async () => {\r\n          this.imageSrc = (\r\n            document.querySelector(\"img[src^='data:image/jpeg;base64']\") ||\r\n            document.querySelector(\"img[src^='data:image/png;base64']\")\r\n          ).src\r\n          const imageBase64 = this.imageSrc.split(',')[1]\r\n          const res = await postsAPI.postImage({ imageBase64: imageBase64 })\r\n          if (res.data.status === 'success') {\r\n            document.querySelector(\"img[src^='data:image/jpeg;base64']\").src =\r\n              res.data.imgurLink\r\n            Toast.fire({\r\n              icon: 'success',\r\n              title: '圖片上傳成功!!'\r\n            })\r\n            // 圖片上傳成功後把 editor 內容回傳到 content 中\r\n            this.content = ed.innerHTML\r\n          }\r\n        }, 100)\r\n      })\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['currentUser'])\r\n  },\r\n  created() {\r\n    const { id: postId } = this.$route.params\r\n    this.fetchPost(postId)\r\n  },\r\n  mounted() {\r\n    this.imageDropListener()\r\n  },\r\n  beforeRouteUpdate(to, from, next) {\r\n    // 路由改變時重新抓取資料\r\n    const { id: postId } = to.params\r\n    this.fetchPost(postId)\r\n    next()\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '../assets/css/medium-editor.css';\r\n@import '../assets/sass/mixins.scss';\r\n\r\n#post-create {\r\n  @include post-editor-container;\r\n  textarea {\r\n    @include post-editor;\r\n  }\r\n  #title {\r\n    @include post-editor-title;\r\n  }\r\n  #content {\r\n    @include post-editor-content;\r\n  }\r\n}\r\n\r\n@media screen and (max-width: 720px) {\r\n  #post-create {\r\n    @include post-editor-container-rwd;\r\n  }\r\n  #title {\r\n    @include post-editor-title-rwd;\r\n  }\r\n  img {\r\n    @include post-editor-img-rwd;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostEdit.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostEdit.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PostEdit.vue?vue&type=template&id=4613248e&scoped=true&\"\nimport script from \"./PostEdit.vue?vue&type=script&lang=js&\"\nexport * from \"./PostEdit.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PostEdit.vue?vue&type=style&index=0&id=4613248e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4613248e\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostEdit.vue?vue&type=style&index=0&id=4613248e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostEdit.vue?vue&type=style&index=0&id=4613248e&lang=scss&scoped=true&\""],"sourceRoot":""}