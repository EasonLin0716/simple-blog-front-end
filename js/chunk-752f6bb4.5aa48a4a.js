(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-752f6bb4"],{"3e26":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"post-create"}},[n("form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleEditPost(e)}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"form-control",attrs:{name:"title",type:"text",placeholder:"Title",id:"title"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),t.image?n("img",{attrs:{src:t.image,alt:"image",width:"640",height:"480"}}):t._e(),n("h6",{staticClass:"d-none"},[t._v("prevent medium editor from deleting input dom")]),n("medium-editor",{attrs:{name:"content",id:"content",text:t.content,options:t.options,"custom-tag":"h4"},on:{edit:t.applyTextEdit}}),n("div",{staticClass:"d-flex justify-content-between"},[n("button",{staticClass:"btn btn-success",attrs:{disabled:t.isPosting,type:"submit"}},[t._v(" "+t._s(t.isPosting?"Editing...":"Edit")+" ")]),n("label",{staticClass:"btn btn-primary",attrs:{for:"image"}},[t._v("Upload cover")]),n("input",{staticClass:"form-control-file d-none",attrs:{id:"image",type:"file",name:"image",accept:"image/*"},on:{change:t.handleFileChange}})])],1)])},r=[],a=(n("a4d3"),n("4de4"),n("e439"),n("dbb4"),n("b64b"),n("d3b7"),n("3ca3"),n("1276"),n("159b"),n("ddb0"),n("2b3d"),n("ade3")),s=(n("96cf"),n("684b")),o=n("4884"),c=n.n(o),u=n("2f62"),d=n("2fa3");function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(a["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var m={name:"PostEdit",data:function(){return{title:"",content:"",image:"",isPosting:!1,authorId:0,options:{toolbar:{allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",relativeContainer:null,standardizeSelectionStart:!1,static:!1,align:"center",sticky:!1,updateOnEmptySelection:!1}}}},components:{"medium-editor":c.a},methods:{handleFileChange:function(t){var e=t.target.files;if(e.length){var n=window.URL.createObjectURL(e[0]);this.image=n}},applyOptions:function(t){try{this.options=JSON.parse(t.target.value),this.optionsValid=!0}catch(e){this.optionsValid=!1}},applyTextEdit:function(t){t.event.target&&(this.content=t.event.target.innerHTML)},fetchPost:function(t){var e,n;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,regeneratorRuntime.awrap(s["a"].getPost(t));case 2:e=i.sent,n=e.data,this.title=n.post.title,this.content=n.post.content,this.authorId=n.author.id,this.image=n.post.cover,this.authorId!==this.currentUser.id&&(d["a"].fire({icon:"error",title:"很抱歉，您沒有編輯權限"}),this.$router.push("/posts/".concat(t)));case 9:case"end":return i.stop()}}),null,this)},handleEditPost:function(t){var e,n,i,r;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,this.isPosting=!0,e=this.$route.params.id,n=new FormData(t.target),n.append("content",this.content),n.append("userId",this.authorId),a.next=8,regeneratorRuntime.awrap(s["a"].putPost(n,e));case 8:i=a.sent,r=i.data,"success"===r.status&&(this.isPosting=!1,d["a"].fire({icon:"success",title:"修改文章大成功！"}),this.$router.push("/posts/".concat(e))),"error"===r.status&&(this.isPosting=!1,d["a"].fire({icon:"error",title:"發生錯誤，請稍後再試！"}),this.$router.push("/posts/".concat(e))),a.next=18;break;case 14:a.prev=14,a.t0=a["catch"](0),this.isPosting=!1,d["a"].fire({icon:"error",title:"修改文章失敗，請稍後再試！"});case 18:case"end":return a.stop()}}),null,this,[[0,14]])},imageDropListener:function(){var t=this,e=document.querySelector("#content");e.addEventListener("drop",(function(){setTimeout((function(){var n,i;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return t.imageSrc=(document.querySelector("img[src^='data:image/jpeg;base64']")||document.querySelector("img[src^='data:image/png;base64']")).src,n=t.imageSrc.split(",")[1],r.next=4,regeneratorRuntime.awrap(s["a"].postImage({imageBase64:n}));case 4:i=r.sent,"success"===i.data.status&&(document.querySelector("img[src^='data:image/jpeg;base64']").src=i.data.imgurLink,d["a"].fire({icon:"success",title:"圖片上傳成功!!"}),t.content=e.innerHTML);case 6:case"end":return r.stop()}}))}),100)}))}},computed:p({},Object(u["b"])(["currentUser"])),created:function(){var t=this.$route.params.id;this.fetchPost(t)},mounted:function(){this.imageDropListener()},beforeRouteUpdate:function(t,e,n){var i=t.params.id;this.fetchPost(i),n()}},h=m,f=(n("40ac"),n("2877")),g=Object(f["a"])(h,i,r,!1,null,"4613248e",null);e["default"]=g.exports},"40ac":function(t,e,n){"use strict";var i=n("b124"),r=n.n(i);r.a},b124:function(t,e,n){}}]);
//# sourceMappingURL=chunk-752f6bb4.5aa48a4a.js.map