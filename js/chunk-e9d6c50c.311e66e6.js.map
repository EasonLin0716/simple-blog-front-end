{"version":3,"sources":["webpack:///./src/views/PostCreate.vue?11e8","webpack:///src/views/PostCreate.vue","webpack:///./src/views/PostCreate.vue?6fb6","webpack:///./src/views/PostCreate.vue","webpack:///./src/views/PostCreate.vue?79a0"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","on","$event","stopPropagation","preventDefault","handleCreatePost","directives","name","rawName","value","expression","staticClass","domProps","target","composing","title","image","_e","_v","content","options","applyTextEdit","isPosting","_s","handleFileChange","staticRenderFns","components","data","imageSrc","toolbar","allowMultiParagraphSelection","buttons","diffLeft","diffTop","firstButtonClass","lastButtonClass","relativeContainer","standardizeSelectionStart","static","align","sticky","updateOnEmptySelection","placeholder","text","hideOnClick","mounted","imageDropListener","methods","files","length","imageURL","applyOptions","JSON","parse","ev","optionsValid","event","innerHTML","ed","addEventListener","setTimeout","computed","component"],"mappings":"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","file":"js/chunk-e9d6c50c.311e66e6.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"post-create\"}},[_c('form',{on:{\"submit\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.handleCreatePost($event)}}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.title),expression:\"title\"}],staticClass:\"mb-2\",attrs:{\"name\":\"title\",\"type\":\"text\",\"placeholder\":\"Title\",\"id\":\"title\"},domProps:{\"value\":(_vm.title)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.title=$event.target.value}}}),(_vm.image)?_c('img',{attrs:{\"src\":_vm.image,\"alt\":\"image\",\"width\":\"640\",\"height\":\"480\"}}):_vm._e(),_c('h6',{staticClass:\"d-none\"},[_vm._v(\"prevent medium editor from deleting input dom\")]),_c('medium-editor',{attrs:{\"name\":\"content\",\"id\":\"content\",\"text\":_vm.content,\"options\":_vm.options,\"custom-tag\":\"h4\"},on:{\"edit\":_vm.applyTextEdit}}),_c('div',{staticClass:\"d-flex justify-content-between\"},[_c('button',{staticClass:\"btn btn-success\",attrs:{\"disabled\":_vm.isPosting,\"type\":\"submit\"}},[_vm._v(\" \"+_vm._s(!_vm.isPosting ? 'Publish' : 'Publising...')+\" \")]),_c('label',{staticClass:\"btn btn-primary\",attrs:{\"for\":\"image\"}},[_vm._v(\"Upload cover\")]),_c('input',{staticClass:\"form-control-file d-none\",attrs:{\"id\":\"image\",\"type\":\"file\",\"name\":\"image\",\"accept\":\"image/*\"},on:{\"change\":_vm.handleFileChange}})])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div id=\"post-create\">\r\n    <form @submit.stop.prevent=\"handleCreatePost\">\r\n      <input\r\n        name=\"title\"\r\n        type=\"text\"\r\n        v-model=\"title\"\r\n        placeholder=\"Title\"\r\n        id=\"title\"\r\n        class=\"mb-2\"\r\n      />\r\n      <img v-if=\"image\" :src=\"image\" alt=\"image\" width=\"640\" height=\"480\" />\r\n      <h6 class=\"d-none\">prevent medium editor from deleting input dom</h6>\r\n      <medium-editor\r\n        name=\"content\"\r\n        id=\"content\"\r\n        :text=\"content\"\r\n        :options=\"options\"\r\n        custom-tag=\"h4\"\r\n        v-on:edit=\"applyTextEdit\"\r\n      >\r\n      </medium-editor>\r\n      <div class=\"d-flex justify-content-between\">\r\n        <button :disabled=\"isPosting\" type=\"submit\" class=\"btn btn-success\">\r\n          {{ !isPosting ? 'Publish' : 'Publising...' }}\r\n        </button>\r\n        <label for=\"image\" class=\"btn btn-primary\">Upload cover</label>\r\n        <input\r\n          id=\"image\"\r\n          type=\"file\"\r\n          name=\"image\"\r\n          accept=\"image/*\"\r\n          class=\"form-control-file d-none\"\r\n          @change=\"handleFileChange\"\r\n        />\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport postsAPI from '../apis/posts'\r\nimport editor from 'vue2-medium-editor'\r\nimport { mapState } from 'vuex'\r\nimport { Toast } from '../utils/helpers'\r\nexport default {\r\n  name: 'PostCreate',\r\n  components: {\r\n    'medium-editor': editor,\r\n  },\r\n  data() {\r\n    return {\r\n      title: '',\r\n      content: '',\r\n      image: '',\r\n      imageSrc: '',\r\n      isPosting: false,\r\n      options: {\r\n        toolbar: {\r\n          allowMultiParagraphSelection: true,\r\n          buttons: [\r\n            'bold',\r\n            'italic',\r\n            'underline',\r\n            'anchor',\r\n            'h1',\r\n            'h2',\r\n            'h3',\r\n            'quote',\r\n          ],\r\n          diffLeft: 0,\r\n          diffTop: -10,\r\n          firstButtonClass: 'medium-editor-button-first',\r\n          lastButtonClass: 'medium-editor-button-last',\r\n          relativeContainer: null,\r\n          standardizeSelectionStart: false,\r\n          static: false,\r\n          /* options which only apply when static is true */\r\n          align: 'center',\r\n          sticky: false,\r\n          updateOnEmptySelection: false,\r\n        },\r\n        placeholder: {\r\n          text: 'Tell your story',\r\n          hideOnClick: true,\r\n        },\r\n      },\r\n    }\r\n  },\r\n  mounted() {\r\n    this.imageDropListener()\r\n  },\r\n  methods: {\r\n    handleFileChange(e) {\r\n      const files = e.target.files\r\n      if (!files.length) return\r\n      const imageURL = window.URL.createObjectURL(files[0])\r\n      this.image = imageURL\r\n    },\r\n    applyOptions(ev) {\r\n      try {\r\n        this.options = JSON.parse(ev.target.value)\r\n        this.optionsValid = true\r\n      } catch (e) {\r\n        this.optionsValid = false\r\n      }\r\n    },\r\n    applyTextEdit(ev) {\r\n      if (ev.event.target) {\r\n        this.content = ev.event.target.innerHTML\r\n      }\r\n    },\r\n    async handleCreatePost(e) {\r\n      try {\r\n        this.isPosting = true\r\n        const formData = new FormData(e.target)\r\n        formData.append('content', this.content)\r\n        formData.append('UserId', this.currentUser.id)\r\n        const { data } = await postsAPI.createPost(formData)\r\n        if (data.status === 'success') {\r\n          Toast.fire({\r\n            icon: 'success',\r\n            title: '文章發布成功！',\r\n          })\r\n          this.isPosting = false\r\n          this.$router.push(`/posts/${data.PostId}`)\r\n        }\r\n      } catch (error) {\r\n        this.isPosting = false\r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '發生錯誤，請稍後再試！',\r\n        })\r\n      }\r\n    },\r\n    imageDropListener() {\r\n      const ed = document.querySelector('#content')\r\n\r\n      ed.addEventListener('drop', () => {\r\n        setTimeout(async () => {\r\n          const image = document.querySelector(\r\n            \"#post-create img[src^='data:image']\"\r\n          )\r\n          if (!image) {\r\n            return Toast.fire({\r\n              icon: 'error',\r\n              title: '上傳圖片失敗',\r\n            })\r\n          }\r\n          const imageBase64 = image.src.split(',')[1]\r\n          const res = await postsAPI.postImage({ imageBase64: imageBase64 })\r\n          if (res.data.status === 'success') {\r\n            image.src = res.data.imgurLink\r\n            console.log(res.data.imgurLink)\r\n            Toast.fire({\r\n              icon: 'success',\r\n              title: '圖片上傳成功!!',\r\n            })\r\n            // 圖片上傳成功後把 editor 內容回傳到 content 中\r\n            this.content = ed.innerHTML\r\n          }\r\n        }, 100)\r\n      })\r\n    },\r\n  },\r\n  computed: {\r\n    ...mapState(['currentUser']),\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '../assets/css/medium-editor.css';\r\n@import '../assets/sass/mixins.scss';\r\n\r\n#post-create {\r\n  @include post-editor-container;\r\n  textarea {\r\n    @include post-editor;\r\n  }\r\n  #title {\r\n    @include post-editor-title;\r\n  }\r\n  #content {\r\n    @include post-editor-content;\r\n  }\r\n}\r\n\r\n@media screen and (max-width: 720px) {\r\n  #post-create {\r\n    @include post-editor-container-rwd;\r\n  }\r\n  #title {\r\n    @include post-editor-title-rwd;\r\n  }\r\n  img {\r\n    @include post-editor-img-rwd;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostCreate.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostCreate.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PostCreate.vue?vue&type=template&id=21a85d40&scoped=true&\"\nimport script from \"./PostCreate.vue?vue&type=script&lang=js&\"\nexport * from \"./PostCreate.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PostCreate.vue?vue&type=style&index=0&id=21a85d40&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"21a85d40\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostCreate.vue?vue&type=style&index=0&id=21a85d40&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PostCreate.vue?vue&type=style&index=0&id=21a85d40&lang=scss&scoped=true&\""],"sourceRoot":""}